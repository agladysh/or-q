# P0001: Help System

Status: **DRAFT**

> [!WARNING] This document is partially generated by AI for AI and may contain mistakes.

## Summary

This proposal outlines the implementation of a comprehensive help system for OR-Q.

## Commands

### `@or-q/plugin-help`

All help commands replace input with their output.

- `help`: Lists all commands with the `help-command` tag in alphabetic order, with their desriptions.
- `help-commands`: List all commands with their descriptions, grouped by plugin
- `help-commands-by-tag "<tag>"`: List all commands with a tag. Tag is arbitrary.
- `help-command "<command>"`: Prints command description and usage string (TBD: plan how to refactor the usage string to
  a parameter)
- `help-plugins`: TBD
- `help-plugin "<plugin.name>"`: TBD
- `help-assets`: TBD

Note that `help-asset` currently makes no sense, as there is no additional information to display

### `@or-q/plugin-discover`

- `discover`: Replaces input with JSON array of all commands with `discovery-command` tag in the form:
  `{"name":"command","description":"command description"}`
- `discover-commands`: TBD list of all commands, full entries (TBD: plan how to refactor the usage string to a
  parameter)
- `discover-plugins`: TBD
- `discover-assets`: TBD

Note filtration commands are redundant, users may filter themselves arbitrarily with `jp`.

### `@or-q/plugin-yaml-script`

Support optional `description` field on assets to show in help

- `help-scripts`: TBD
- `help-script "<script>"`: TBD
- `discover-scripts`: TBD
- `discover-script "<script>"`: displays full script YAML

### Other Plugins

#### Legacy Help-like Command Elimination

TBD. Identify `dump`, `list`, `*json*` and similar commands which essentially are `help` and `discover`, describe here
how they should be _replaced_. Note that not all commands with same naming conventions are help- or discover- like.

#### Help and Discover Commands

Adding new help and discover commands to other plugins is not in scope of this proposal.

## Reference Command Output Formats

Illustrative, not normative.

TBD, illustrative abbreviated outputs example for each command based on actual existing code.

## Other Code Changes

Non-exhaustive:

- Remove `IPluginRuntime.usage()`
- Add `@or-q/cli` dependency on `@or-q/help`
- Add `description: pkg.description` to every plugin `index.ts`
- Add optional `tags` field on Command as array of strings
- Add mandatory `usage` field on Command, and refactor all commands to expose it
- Add appropriate lookup dictionaries to `PluginRuntime` class
- export `tagHelpCommand` constant from `@or-q/plugin-help` and use it in help command definitions
- export `tagDiscoverCommand` constant from `@or-q/plugin-discover` and use it in discover command definitions

## Design Principles

### 1. Programmatic Content Generation

All help commands are programmatic, using existing content:

- **Plugin metadata**: `Plugin.name` (existing) and `Plugin.description` (new field, re-export from Plugin's
  `package.json`)
- **Command descriptions**: Already present in command definitions
- **Runtime state**: Available plugins, commands, assets from runtime
- **No duplication**: No separate help content to maintain

### 2. Enhanced Command Metadata

Commands get an optional `tags` array for flexible categorization. Tags recognized by the help and discovery systems:

- `help-command`: Commands that provide help functionality
- `discovery-command`: Commands that provide discovery/metadata functionality

Plugins can use additional domain-specific tags as needed.

### 3. Separation of Concerns

- **Human-readable help**: `help` and `help-*` commands provide formatted, user-friendly output
- **Machine-readable data**: `discover` and `discover-*` commands provide structured data for programmatic use
- **Plugin-extensible**: Each plugin may export its own help and/or discovery commands

### 4. CLI Integration

When OR-Q is invoked with no arguments:

1. Output brief standard cli usage header
2. Check if `help` command exists in the runtime
3. If yes, execute it on general principles
4. If no, show a generic fallback message: `help command not available, install the @or-q/plugin-help npm package`

## Motivation

### Why This Approach

OR-Q's current help situation is problematic:

1. **User Onboarding**: New users cannot discover available functionality
2. **Plugin Discovery**: No way to understand what plugins provide
3. **Script Visibility**: YAML scripts are invisible without prior knowledge
4. **Developer Experience**: Plugin authors have no standard way to expose help
5. **Architectural Debt**: It is best to introduce breaking changes early

### Why Not Optional Arguments

The ideal solution would be `help [command]` syntax, but OR-Q's sequential argument consumption (`args.shift()`) makes
optional arguments architecturally impossible. Commands cannot peek ahead without consuming arguments.

### Why Not Hierarchical Commands

A seemingly elegant alternative would be `help commands`, `help plugins`, etc. However, this is architecturally
impossible due to OR-Q's stack-based argument consumption:

The `help` command cannot determine if `commands` is an argument for the help command (e.g., "show me help about
commands") or a legitimate command name that should be left for the next pipeline stage.

## Implementation Notes

TBD Derive from [codebase.md](../codebase.md)
