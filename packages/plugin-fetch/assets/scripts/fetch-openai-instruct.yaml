description: OpenAI-compatible chat completion request macro for fetch operations

requires:
  - '@or-q/plugin-openrouter-api' # TODO: Migrate general openai conversation stuff from there and update this dependency
  - '@or-q/plugin-ollama'
  - '@or-q/plugin-store'
  - '@or-q/plugin-jp'

commands:
  - $defmacro:
      - $fetch-openai-instruct
      - - _JSON:
            method: POST
            headers:
              Content-Type: application/json
            body:
              model:
                _RAW: [$arg: 2]
              temperature: 0
              messages:
                - role: system
                  content:
                    _RAW: [$arg: 3]
                - role: user
                  content:
                    _RAW: [$arg: 4]
        - fetch: [[$arg: 1]]
        - tee
        - jp: 'choices[0].message.content'
        - unquote
